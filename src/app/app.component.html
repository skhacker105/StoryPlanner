
<app-player [openSecondLayer]="movieService.selectedLayer || memberService.selectedMember ? true : false">
  <app-time-line timeLine></app-time-line>

  <app-canvas canvas></app-canvas>

  <ng-container control>
    <mat-tab-group [selectedIndex]="selectedIndex"
    animationDuration="500ms" class="control-tab-group"
    (selectedTabChange)="handleTabChange($event)">

      <!-- My Book tab -->
      <mat-tab>
        <ng-template mat-tab-label>
          <div class="control-tab">
            <div>{{ memberService.memberBookName }}</div>
            <div class="version">{{ memberService.versionNoString }}</div>
          </div>
        </ng-template>
        <app-member-control></app-member-control>
      </mat-tab>

      <!-- Layers of My Movie for Selected Time -->
      <mat-tab label="Movie">
        <ng-template mat-tab-label *ngIf="movieService.movie">
          <div class="control-tab">
            <div>{{ movieService.movie.movieName }}</div>
            <div class="version">{{ movieService.versionNoString }}</div>
          </div>
        </ng-template>
        <app-layer-control></app-layer-control>
      </mat-tab>

      <!-- Download Upload -->
      <!-- <mat-tab label="Save">
        <ng-template mat-tab-label>
          <button mat-icon-button>
            <mat-icon>save</mat-icon>
          </button>
        </ng-template>
      </mat-tab> -->
    </mat-tab-group>
  </ng-container>

  <ng-container controlHeader *ngIf="movieService.selectedLayer">
    <app-popup-header controlHeader [title]="'Layer ' + movieService.selectedLayer.stackPosition" (onCloseTrigger)="movieService.resetSelectedLayer()">
    </app-popup-header>
  </ng-container>
  <ng-container control2 *ngIf="movieService.selectedLayer">
      <div class="list-container">
          <app-layer-properties
          [time]="movieService.selectedLayerTime || movieService.selectedLayerTime === 0 ? movieService.selectedLayerTime : timelineService.endTime.value"
          [endTime]="timelineService.endTime.value"
          [layer]="movieService.selectedLayer"
          [layerMember]="movieService.dictionaryMemberBook[movieService.selectedLayer.memberId].member" 
          [layerOption]="movieService.dictionaryMemberBook[movieService.selectedLayer.memberId].options[movieService.selectedLayer.memberOptionId]"
          (onCancel)="movieService.resetSelectedLayer()"
          (onSave)="saveLayer($event)">
          </app-layer-properties>
      </div>

  </ng-container>

  <ng-container controlHeader *ngIf="memberService.selectedMember">
    <app-popup-header controlHeader [title]="memberService.selectedMember.name" (onCloseTrigger)="memberService.resetSelectedRecord()">
    </app-popup-header>
  </ng-container>
  <ng-container control2 *ngIf="memberService.selectedMember">
    <div  class="list-container">
        @for (option of memberService.selectedMember.options; track option) {
            <app-member-option-display [option]="option" (addToTimeLine)="addOptionToMovieTimeLine(memberService.selectedMember, option)">
            </app-member-option-display>
        }
    </div>
  </ng-container>
</app-player>
<!-- <router-outlet /> -->
